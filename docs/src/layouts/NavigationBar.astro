---
import {
    getLanguageFromURL,
    useTranslations,
    useTranslatedPath,
} from "../i18n/utilities.js";
import { Image } from "astro:assets";

import LanguageSelector from "../components/LanguageSelector.astro";
import SocialIcons from "../components/SocialIcons.astro";
import ThemeSelector from "../components/ThemeSelector.astro";
import Version from "../components/Version.astro";

import logo from "../assets/logo.svg";

const { noSidebar = false } = Astro.props;

const language = getLanguageFromURL(Astro.url);
const translation = useTranslations(language);
const translatePath = useTranslatedPath(language);
---

<!-- Quicksand font — Bunny Fonts -->
<link
    rel="stylesheet"
    href="https://fonts.bunny.net/css?family=quicksand:600&display=swap"
/>

<header role="banner" class="navbar pc-cloak">
    <nav
        class="navigation-bar"
        aria-label={translation("navbar.aria") as string}
    >
        <div class="left-section">
            <pc-button
                class:list={{
                    "sidebar-toggle": true,
                    "pc-992-size": !noSidebar,
                }}
                size="small"
                variant="plain"
            >
                <pc-icon
                    class="rest-only"
                    library="default"
                    icon-style="solid"
                    name="bars"
                    label={translation("button.sidebar.open")}></pc-icon>
                <pc-icon
                    class="hover-only"
                    library="default"
                    icon-style="solid"
                    name="burger"
                    label={translation("button.sidebar.open")}></pc-icon>
            </pc-button>
            <a href={translatePath("/")}>
                <Image
                    src={logo}
                    width={36}
                    height={36}
                    style="translate: 0 -0.125rem"
                    loading="eager"
                    alt=""
                />
                <span class="logo-wordmark pc-not-992-size">
                    Placer Toolkit
                </span>
                <span class="pc-992-size pc-visually-hidden">
                    Placer Toolkit
                </span>
            </a>
            <small class="pc-not-992-size">
                <Version />
            </small>
            <pc-badge
                class="pc-not-992-size"
                appearance="warning"
                variant="filled"
            >
                Alpha
            </pc-badge>
        </div>
        <div class="right-section">
            <div class="pc-not-992-size">
                <SocialIcons />
                <pc-divider orientation="vertical"></pc-divider>
            </div>
            <ThemeSelector />
            <LanguageSelector />
            <pc-divider class="pc-desktop-only" orientation="vertical"
            ></pc-divider>
            <pc-button
                class="search-desktop"
                appearance="neutral"
                variant="outlined"
                size="small"
                data-dialog="open search-dialog"
                aria-keyshortcuts="Control+K"
            >
                <pc-icon
                    library="default"
                    icon-style="solid"
                    name="magnifying-glass"
                    slot="prefix"></pc-icon>
                <span class="label">{translation("ui.search.button")}</span>
                <span slot="suffix">
                    <kbd class="search-key"
                        >{translation("ui.keyboard.ctrl")}</kbd
                    >
                    <kbd class="search-key">K</kbd>
                </span>
            </pc-button>
            <!-- Mobile search button -->
            <pc-button
                class="search-mobile"
                appearance="neutral"
                variant="outlined"
                size="small"
                data-dialog="open search-dialog"
                aria-keyshortcuts="Control+K"
            >
                <pc-icon
                    class="icon-expand"
                    library="default"
                    icon-style="solid"
                    name="magnifying-glass"
                    label={translation("ui.search.button") as string}></pc-icon>
            </pc-button>
        </div>
    </nav>
</header>

<script>
    const searchButton = document.querySelector(
        'pc-button[data-dialog="open search-dialog"]',
    );
    const switchKey = searchButton?.querySelector("kbd:first-child");

    if (
        searchButton &&
        switchKey &&
        /(Mac|iPhone|iPod|iPad)/i.test(navigator.platform)
    ) {
        switchKey.textContent = "⌘";
        searchButton.setAttribute("aria-keyshortcuts", "Meta+K");
    }
</script>

<style>
    .navbar {
        grid-area: navbar;
        position: sticky;
        inset-block-start: 0;
        inset-block: 0;
        background-color: var(--pc-color-surface-default);
        border-block-end: var(--pc-border-width-s) var(--pc-border-style)
            var(--pc-color-surface-border);
        inline-size: 100vw;
        block-size: 3.5rem;
        z-index: 2;
        pointer-events: auto;
    }

    .navigation-bar {
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding-block: var(--pc-spacing-l);
        padding-inline: var(--pc-spacing-m);
        block-size: 100%;
    }

    .navigation-bar pc-divider {
        --spacing: var(--pc-spacing-xs);
    }

    .navigation-bar div {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--pc-spacing-m);
    }

    .navigation-bar div > * {
        flex-shrink: 0;
    }

    .navigation-bar .left-section a {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: var(--pc-spacing-s);
        color: inherit;
        text-decoration: none;
    }

    .navigation-bar .left-section a .logo-wordmark {
        font-family: "Quicksand", var(--pc-font-sans);
        font-weight: var(--pc-font-weight-semibold);
        user-select: none;
        -webkit-user-select: none;
    }

    .navigation-bar .left-section small {
        color: var(--pc-color-text-quiet);
        font-size: var(--pc-font-size-smaller);
        translate: 0 0.0625rem;
        vertical-align: bottom;
    }

    .navigation-bar .right-section .search-desktop span[slot="suffix"] {
        display: inline-block;
        margin-block-end: 0.25rem;
    }

    .navigation-bar .right-section .search-desktop kbd {
        padding-inline: 0.5em;
        font-size: var(--pc-font-size-xxs);
        line-height: var(--pc-form-control-value-line-height);
    }

    .navigation-bar .right-section .search-mobile {
        display: none;
    }

    @media screen and (max-width: 992px) {
        .navigation-bar .right-section .search-desktop span[slot="suffix"] {
            display: none;
        }
    }

    @media screen and (max-width: 500px) {
        .navigation-bar .right-section .search-desktop {
            display: none;
        }

        .navigation-bar .right-section .search-mobile {
            display: block;
        }
    }
</style>
