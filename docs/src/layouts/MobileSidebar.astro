---
import NavigationIcons from "../components/NavigationIcons.astro";
---

<pc-drawer class="mobile-sidebar" placement="start">
    <span class="pc-visually-hidden" slot="label">Sidebar</span>

    <NavigationIcons
        slotName="header-actions"
        variant="plain"
        is992Size={true}
    />

    <pc-details variant="outlined" summary="Get started" data-id="get-started">
        <ul>
            <li>
                <a href="/get-started/installation">Installation</a>
            </li>
            <li>
                <a href="/get-started/usage">Usage</a>
            </li>
            <li>
                <a href="/get-started/customisation">Customisation</a>
            </li>
            <li>
                <a href="/get-started/form-controls">Form controls</a>
            </li>
            <li>
                <a href="/get-started/localisation">Localisation</a>
            </li>
        </ul>
    </pc-details>
    <pc-details variant="outlined" data-id="design-tokens">
        <a href="/design-tokens" class="summary-link" slot="summary">
            Design tokens
        </a>

        <ul>
            <li>
                <a href="/design-tokens/borders">Borders</a>
            </li>
            <li>
                <a href="/design-tokens/colour">Colour</a>
            </li>
            <li>
                <a href="/design-tokens/focus">Focus</a>
            </li>
            <li>
                <a href="/design-tokens/shadows">Shadows</a>
            </li>
            <li>
                <a href="/design-tokens/spacing">Spacing</a>
            </li>
            <li>
                <a href="/design-tokens/transitions">Transitions</a>
            </li>
            <li>
                <a href="/design-tokens/typography">Typography</a>
            </li>
            <li>
                <a href="/design-tokens/component-groups">Component groups</a>
            </li>
        </ul>
    </pc-details>
    <pc-details variant="outlined" data-id="components">
        <a href="/components" class="summary-link" slot="summary">
            Components
            <pc-icon library="default" icon-style="solid" name="flask"
            ></pc-icon>
        </a>

        <ul>
            <li>
                <a href="/components/animation">Animation</a>
            </li>
            <li>
                <a href="/components/avatar">Avatar</a>
            </li>
            <li>
                <a href="/components/badge">Badge</a>
            </li>
            <li>
                <a href="/components/button">Button</a>
            </li>
            <li>
                <a href="/components/button-group">Button Group</a>
            </li>
            <li>
                <a href="/components/callout">Callout</a>
            </li>
            <li>
                <a href="/components/card">Card</a>
            </li>
            <li>
                <a href="/components/checkbox">Checkbox</a>
            </li>
            <li>
                <a href="/components/color-picker">Color Picker</a>
            </li>
            <li>
                <a href="/components/comparer">Comparer</a>
            </li>
            <li>
                <a href="/components/copy-button">Copy Button</a>
            </li>
            <li>
                <a href="/components/details">Details</a>
            </li>
            <li>
                <a href="/components/dialog">Dialog</a>
            </li>
            <li>
                <a href="/components/divider">Divider</a>
            </li>
            <li>
                <a href="/components/drawer">Drawer</a>
            </li>
            <li>
                <a href="/components/dropdown">Dropdown</a>
                <ul>
                    <li>
                        <a href="/components/dropdown-item">Dropdown Item</a>
                    </li>
                </ul>
            </li>
            <li>
                <a href="/components/format-bytes">Format Bytes</a>
            </li>
            <li>
                <a href="/components/format-date">Format Date</a>
            </li>
            <li>
                <a href="/components/format-number">Format Number</a>
            </li>
            <li>
                <a href="/components/icon">Icon</a>
            </li>
            <li>
                <a href="/components/input">Input</a>
            </li>
            <li>
                <a href="/components/mutation-observer">Mutation Observer</a>
            </li>
            <li>
                <a href="/components/popup">Popup</a>
            </li>
            <li>
                <a href="/components/qr-code">QR Code</a>
            </li>
            <li>
                <a href="/components/radio-group">Radio Group</a>
                <ul>
                    <li>
                        <a href="/components/radio">Radio</a>
                    </li>
                </ul>
            </li>
            <li>
                <a href="/components/rating">Rating</a>
            </li>
            <li>
                <a href="/components/resize-observer">Resize Observer</a>
            </li>
            <li>
                <a href="/components/scroller">Scroller</a>
            </li>
            <li>
                <a href="/components/select">Select</a>
                <ul>
                    <li>
                        <a href="/components/option">Option</a>
                    </li>
                </ul>
            </li>
            <li>
                <a href="/components/spinner">Spinner</a>
            </li>
            <li>
                <a href="/components/switch">Switch</a>
            </li>
            <li>
                <a href="/components/tab-group">Tab Group</a>
                <ul>
                    <li>
                        <a href="/components/tab">Tab</a>
                    </li>
                    <li>
                        <a href="/components/tab-panel">Tab Panel</a>
                    </li>
                </ul>
            </li>
            <li>
                <a href="/components/tag">Tag</a>
            </li>
            <li>
                <a href="/components/textarea">Textarea</a>
            </li>
            <li>
                <a href="/components/tooltip">Tooltip</a>
            </li>
        </ul>
    </pc-details>
    <pc-details variant="outlined" data-id="layout">
        <a href="/layout" class="summary-link" slot="summary">Layout</a>

        <ul>
            <li>
                <a href="/layout/align-items">Align items</a>
            </li>
            <li>
                <a href="/layout/cluster">Cluster</a>
            </li>
            <li>
                <a href="/layout/flank">Flank</a>
            </li>
            <li>
                <a href="/layout/frame">Frame</a>
            </li>
            <li>
                <a href="/layout/gap">Gap</a>
            </li>
            <li>
                <a href="/layout/grid">Grid</a>
            </li>
            <li>
                <a href="/layout/split">Split</a>
            </li>
            <li>
                <a href="/layout/stack">Stack</a>
            </li>
        </ul>
    </pc-details>
    <pc-details variant="outlined" data-id="style-utilities">
        <a href="/style-utilities" class="summary-link" slot="summary">
            Style utilities
        </a>

        <ul>
            <li>
                <a href="/style-utilities/native-styles">Native styles</a>
            </li>
            <li>
                <a href="/style-utilities/reduce-fouce">Reduce FOUCE</a>
            </li>
            <li>
                <a href="/style-utilities/rounding">Rounding</a>
            </li>
            <li>
                <a href="/style-utilities/text">Text</a>
            </li>
            <li>
                <a href="/style-utilities/visually-hidden">Visually Hidden</a>
            </li>
        </ul>
    </pc-details>
    <pc-details variant="outlined" summary="Resources" data-id="resources">
        <ul>
            <li>
                <a href="/resources/community">Community</a>
            </li>
            <li>
                <a href="/resources/contributing">Contributing</a>
            </li>
            <li>
                <a href="/resources/accessibility">Accessibility</a>
            </li>
            <li>
                <a href="/resources/brand-assets">Brand assets</a>
            </li>
            <li>
                <a href="/resources/changelog">Changelog</a>
            </li>
            <li>
                <a
                    href="https://github.com/placer-toolkit/placer-toolkit/discussions"
                >
                    Support
                    <pc-icon
                        class="external-link"
                        library="default"
                        icon-style="solid"
                        name="arrow-up"></pc-icon>
                </a>
            </li>
        </ul>
    </pc-details>

    <div class="other-links">
        <div class="pc-cluster">
            <button data-dialog="open contact-info">Contact</button>
            <a href="/legal/privacy">Privacy</a>
            <a href="/legal/code-of-conduct">Code of Conduct</a>
            <a href="/legal/licence">Licence</a>
            <a href="/legal/impressum">Impressum</a>
        </div>

        <span class="attribution">
            © 2025 Placer •
            <a href="https://astro.build">
                <img
                    src="https://astro.badg.es/v2/built-with-astro/tiny.svg"
                    alt="Built with Astro"
                />
            </a>
        </span>
    </div>
</pc-drawer>

<script>
    import type { PcDetails } from "placer-toolkit/dist/components/details/details.js";
    import type { PcDrawer } from "placer-toolkit/dist/components/drawer/drawer.js";

    document.addEventListener("DOMContentLoaded", () => {
        const drawer: PcDrawer | null =
            document.querySelector(".mobile-sidebar");
        const currentPath = window.location.pathname.replace(/\/$/, "");
        const links = document.querySelectorAll(".mobile-sidebar a");
        const detailsElements = document.querySelectorAll<PcDetails>(
            ".mobile-sidebar pc-details",
        );

        links.forEach((link) => {
            const href = link.getAttribute("href");
            const linkPath = href ? href.replace(/\/$/, "") : "";
            if (linkPath === currentPath) {
                link.setAttribute("aria-current", "page");
            } else {
                link.removeAttribute("aria-current");
            }
        });

        function updateSidebarState() {
            setTimeout(() => {
                const currentlyOpen = Array.from(detailsElements)
                    .filter(
                        (detail) =>
                            detail.hasAttribute("open") &&
                            detail.getAttribute("data-id"),
                    )
                    .map((detail) => detail.getAttribute("data-id")!);

                localStorage.setItem(
                    "open-sidebar-sections",
                    JSON.stringify(currentlyOpen),
                );
            }, 0);
        }

        let isInitializing = true;

        detailsElements.forEach((element) => {
            const id = element.getAttribute("data-id");

            if (!id) {
                return;
            }

            element.addEventListener("pc-show", () => {
                if (!isInitializing) {
                    updateSidebarState();
                }
            });

            element.addEventListener("pc-hide", () => {
                if (!isInitializing) {
                    updateSidebarState();
                }
            });
        });

        try {
            const stored = localStorage.getItem("open-sidebar-sections");

            if (stored !== null) {
                const openIds: string[] = JSON.parse(stored);

                detailsElements.forEach((element) => {
                    const id = element.getAttribute("data-id");

                    if (id) {
                        if (openIds.includes(id)) {
                            element.show();
                        } else {
                            element.hide();
                        }
                    }
                });
            } else {
                detailsElements.forEach((element) => {
                    const id = element.getAttribute("data-id");

                    if (id === "get-started") {
                        element.show();
                    } else {
                        element.hide();
                    }
                });
            }
        } catch (error) {
            console.warn(`Could not restore sidebar state: ${error}`);
            detailsElements.forEach((element) => {
                const id = element.getAttribute("data-id");

                if (id === "get-started") {
                    element.show();
                } else {
                    element.hide();
                }
            });
        }

        setTimeout(() => {
            isInitializing = false;
        }, 100);

        function handleResize() {
            if (window.innerWidth > 1440) {
                if (!drawer) {
                    return;
                }

                drawer.open = false;
            }
        }

        window.addEventListener("resize", handleResize);
        handleResize();
    });

    const summaryLinks = document.querySelectorAll(
        ".mobile-sidebar .summary-link",
    );

    summaryLinks.forEach((link) => {
        link.addEventListener("click", (event) => {
            event.stopPropagation();
        });

        link.addEventListener("keydown", (event) => {
            event.stopPropagation();
        });
    });
</script>

<style>
    .mobile-sidebar::part(drawer) {
        background-color: var(--pc-color-surface-default);
        border-inline-end: var(--pc-border-width-s) var(--pc-border-style)
            var(--pc-color-surface-border);
    }

    .mobile-sidebar::part(title) {
        font-weight: var(--pc-font-weight-normal);
    }

    .mobile-sidebar pc-details:not(:last-of-type) {
        margin-block-end: var(--pc-spacing-s);
    }

    .mobile-sidebar pc-details::part(summary) {
        font-weight: var(--pc-font-weight-bold);
    }

    .mobile-sidebar pc-details a[slot="summary"] {
        color: var(--pc-color-text-normal);
        text-decoration: none;
    }

    .mobile-sidebar pc-details a[slot="summary"] pc-icon {
        color: color-mix(in oklab, currentColor, var(--pc-color-mix-hover));
    }

    @media (hover: hover) {
        .mobile-sidebar pc-details a[slot="summary"]:hover {
            color: color-mix(
                in oklab,
                var(--pc-color-text-link),
                var(--pc-color-mix-hover)
            );
        }
    }

    .mobile-sidebar pc-details a[slot="summary"]:active {
        color: color-mix(
            in oklab,
            var(--pc-color-text-link),
            var(--pc-color-mix-active)
        );
    }

    .mobile-sidebar pc-details ul {
        display: flex;
        flex-direction: column;
        gap: var(--pc-spacing-s);
        margin-inline-start: var(--pc-spacing-xs);
        padding-inline-start: var(--pc-spacing-l);
        border-inline-start: var(--pc-border-width-s) var(--pc-border-style)
            var(--pc-color-neutral-border-quiet);
        list-style: none;
    }

    .mobile-sidebar pc-details > ul {
        margin-block-start: calc(-1 * var(--pc-spacing-l));
    }

    .mobile-sidebar pc-details ul li a {
        margin-inline-start: calc(
            -1 * (var(--pc-spacing-l) + var(--pc-border-width-s))
        );
        padding-inline-start: calc(
            var(--pc-spacing-l) - var(--pc-border-width-s)
        );
        color: color-mix(
            in oklab,
            var(--pc-color-text-normal),
            var(--pc-color-surface-default) 15%
        );
        border-radius: 0;
        border-inline-start: var(--pc-border-width-s) var(--pc-border-style)
            transparent;
        font-weight: var(--pc-font-weight-normal);
        text-decoration: none;
    }

    @media (hover: hover) {
        .mobile-sidebar pc-details ul li a:hover {
            color: var(--pc-color-text-normal);
            border-color: var(--pc-color-neutral-on-quiet);
        }
    }

    .mobile-sidebar pc-details ul li a:active {
        color: color-mix(
            in oklab,
            var(--pc-color-text-normal),
            var(--pc-color-mix-active)
        );
        border-color: color-mix(
            in oklab,
            var(--pc-color-neutral-on-quiet),
            var(--pc-color-mix-active)
        );
    }

    .mobile-sidebar pc-details ul li a[aria-current="page"] {
        color: var(--pc-color-primary-on-quiet);
        border-color: var(--pc-color-primary-on-quiet);
        font-weight: var(--pc-font-weight-semibold);
    }

    .mobile-sidebar pc-details ul li a pc-icon.external-link {
        margin-inline-start: var(--pc-spacing-s);
        color: var(--pc-color-text-quiet);
        rotate: 45deg;
        translate: 0 0.125rem;
    }

    .mobile-sidebar pc-details ul li ul {
        margin-block-start: var(--pc-spacing-s);
    }

    .mobile-sidebar .other-links {
        margin-block-start: var(--pc-spacing-l);
        margin-inline: var(--pc-spacing-s);
    }

    .mobile-sidebar .other-links div.pc-cluster {
        row-gap: var(--pc-spacing-xxxs);
    }

    .mobile-sidebar .other-links button {
        all: unset;
        border-radius: var(--pc-border-radius-s);
        cursor: pointer;
        transition: all var(--pc-transition-fast) ease-in-out;
    }

    .mobile-sidebar .other-links button:focus-visible {
        outline: var(--pc-focus-ring);
        outline-offset: var(--pc-focus-ring-offset);
        animation: focus-ring-animation var(--pc-transition-medium)
            cubic-bezier(0.33, 1, 0.68, 1);
    }

    .mobile-sidebar .other-links button,
    .mobile-sidebar .other-links a {
        color: var(--pc-color-neutral-on-quiet);
        font-weight: var(--pc-font-weight-semibold);
        font-size: var(--pc-font-size-smaller);
        text-decoration: none;
    }

    @media (hover: hover) {
        .mobile-sidebar .other-links button:hover,
        .mobile-sidebar .other-links a:hover {
            color: color-mix(
                in oklab,
                var(--pc-color-neutral-on-quiet),
                var(--pc-color-mix-hover)
            );
            text-decoration: var(--pc-link-decoration-hover);
        }
    }

    .mobile-sidebar .other-links button:active,
    .mobile-sidebar .other-links a:active {
        color: color-mix(
            in oklab,
            var(--pc-color-neutral-on-quiet),
            var(--pc-color-mix-active)
        );
        text-decoration: var(--pc-link-decoration-active);
    }

    :global(.pc-theme-utility)
        .mobile-sidebar
        .other-links
        :is(button, a):is(:hover, :active) {
        color: var(--pc-color-text-normal);
    }

    .mobile-sidebar .other-links .attribution {
        display: inline-block;
        align-items: center;
        margin-block-start: var(--pc-spacing-xs);
        color: var(--pc-color-neutral-on-quiet);
        font-size: var(--pc-font-size-smaller);
        font-weight: var(--pc-font-weight-medium);
    }

    .mobile-sidebar .other-links .attribution img {
        position: relative;
        inset-block-start: var(--pc-spacing-xs);
        border-radius: 0;
    }
</style>
