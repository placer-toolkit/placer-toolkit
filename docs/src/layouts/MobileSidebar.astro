<pc-drawer class="mobile-sidebar" placement="start">
    <pc-details summary="Get started" data-id="get-started">
        <ul>
            <li>
                <a href="/">Home</a>
            </li>
            <li>
                <a href="/get-started/installation">Installation</a>
            </li>
            <li>
                <a href="/get-started/usage">Usage</a>
            </li>
            <li>
                <a href="/get-started/customisation">Customisation</a>
            </li>
            <li>
                <a href="/get-started/form-controls">Form controls</a>
            </li>
        </ul>
    </pc-details>
    <pc-details data-id="design-tokens">
        <a href="/design-tokens" class="summary-link" slot="summary">
            Design tokens
        </a>

        <ul>
            <li>
                <a href="/design-tokens/colour">Colour</a>
            </li>
            <li>
                <a href="/design-tokens/spacing">Spacing</a>
            </li>
            <li>
                <a href="/design-tokens/shadows">Shadows</a>
            </li>
            <li>
                <a href="/design-tokens/border-radius">Border radius</a>
            </li>
            <li>
                <a href="/design-tokens/transitions">Transitions</a>
            </li>
            <li>
                <a href="/design-tokens/z-index">Z‚Äêindex</a>
            </li>
            <li>
                <a href="/design-tokens/typography">Typography</a>
            </li>
            <li>
                <a href="/design-tokens/other-tokens">Other tokens</a>
            </li>
        </ul>
    </pc-details>
    <pc-details data-id="components">
        <a href="/components" class="summary-link" slot="summary">
            Components
            <pc-icon
                library="default"
                icon-style="solid"
                name="flask"
            ></pc-icon>
        </a>

        <ul>
            <li>
                <a href="/components/animation">Animation</a>
            </li>
            <li>
                <a href="/components/avatar">Avatar</a>
            </li>
            <li>
                <a href="/components/badge">Badge</a>
            </li>
            <li>
                <a href="/components/button">Button</a>
            </li>
            <li>
                <a href="/components/button-group">Button Group</a>
            </li>
            <li>
                <a href="/components/callout">Callout</a>
            </li>
            <li>
                <a href="/components/card">Card</a>
            </li>
            <li>
                <a href="/components/checkbox">Checkbox</a>
            </li>
            <li>
                <a href="/components/comparer">Comparer</a>
            </li>
            <li>
                <a href="/components/copy-button">Copy Button</a>
            </li>
            <li>
                <a href="/components/details">Details</a>
            </li>
            <li>
                <a href="/components/dialog">Dialog</a>
            </li>
            <li>
                <a href="/components/divider">Divider</a>
            </li>
            <li>
                <a href="/components/drawer">Drawer</a>
            </li>
            <li>
                <a href="/components/dropdown">Dropdown</a>
            </li>
            <li>
                <a href="/components/icon">Icon</a>
            </li>
            <li>
                <a href="/components/icon-button">Icon Button</a>
            </li>
            <li>
                <a href="/components/input">Input</a>
            </li>
            <li>
                <a href="/components/menu">Menu</a>
                <ul>
                    <li>
                        <a href="/components/menu-item">Menu Item</a>
                    </li>
                    <li>
                        <a href="/components/menu-label">Menu Label</a>
                    </li>
                </ul>
            </li>
            <li>
                <a href="/components/popup">Popup</a>
            </li>
            <li>
                <a href="/components/qr-code">QR Code</a>
            </li>
            <li>
                <a href="/components/radio-group">Radio Group</a>
                <ul>
                    <li>
                        <a href="/components/radio">Radio</a>
                    </li>
                    <li>
                        <a href="/components/radio-button">Radio Button</a>
                    </li>
                </ul>
            </li>
            <li>
                <a href="/components/rating">Rating</a>
            </li>
            <li>
                <a href="/components/resize-observer">Resize Observer</a>
            </li>
            <li>
                <a href="/components/select">Select</a>
                <ul>
                    <li>
                        <a href="/components/option">Option</a>
                    </li>
                </ul>
            </li>
            <li>
                <a href="/components/spinner">Spinner</a>
            </li>
            <li>
                <a href="/components/switch">Switch</a>
            </li>
            <li>
                <a href="/components/tab-group">Tab Group</a>
                <ul>
                    <li>
                        <a href="/components/tab">Tab</a>
                    </li>
                    <li>
                        <a href="/components/tab-panel">Tab Panel</a>
                    </li>
                </ul>
            </li>
            <li>
                <a href="/components/tag">Tag</a>
            </li>
            <li>
                <a href="/components/tooltip">Tooltip</a>
            </li>
        </ul>
    </pc-details>
    <pc-details data-id="style-utilities">
        <a href="/style-utilities" class="summary-link" slot="summary">
            Style utilities
        </a>

        <ul>
            <li>
                <a href="/style-utilities/reduce-fouce">Reduce FOUCE</a>
            </li>
            <li>
                <a href="/style-utilities/visually-hidden">Visually Hidden</a>
            </li>
        </ul>
    </pc-details>
    <pc-details summary="Resources" data-id="resources">
        <ul>
            <li>
                <a href="/resources/community">Community</a>
            </li>
            <li>
                <a href="/resources/contributing">Contributing</a>
            </li>
            <li>
                <a href="/resources/accessibility">Accessibility</a>
            </li>
            <li>
                <a href="/resources/changelog">Changelog</a>
            </li>
            <li>
                <a href="/resources/support">Support</a>
            </li>
        </ul>
    </pc-details>
</pc-drawer>

<script>
    document.addEventListener("DOMContentLoaded", () => {
        const currentPath = window.location.pathname.replace(/\/$/, "");
        const links = document.querySelectorAll(".mobile-sidebar a");
        const detailsElements = document.querySelectorAll(".mobile-sidebar pc-details");

        links.forEach((link) => {
            const href = link.getAttribute("href");
            const linkPath = href ? href.replace(/\/$/, "") : "";
            if (linkPath === currentPath) {
                link.setAttribute("aria-current", "page");
            } else {
                link.removeAttribute("aria-current");
            }
        });

        function updateSidebarState() {
            setTimeout(() => {
                const currentlyOpen = Array.from(detailsElements)
                    .filter((detail) => detail.hasAttribute("open") && detail.getAttribute("data-id"))
                    .map((detail) => detail.getAttribute("data-id"));
                localStorage.setItem("open-sidebar-sections", JSON.stringify(currentlyOpen));
            }, 0);
        }

        let isInitializing = true;

        detailsElements.forEach((element) => {
            const id = element.getAttribute("data-id");
            if (!id) return;

            element.addEventListener("pc-show", () => {
                if (!isInitializing) {
                    updateSidebarState();
                }
            });

            element.addEventListener("pc-hide", () => {
                if (!isInitializing) {
                    updateSidebarState();
                }
            });
        });

        try {
            const stored = localStorage.getItem("open-sidebar-sections");

            if (stored !== null) {
                const openIds = JSON.parse(stored);

                detailsElements.forEach((element: any) => {
                    const id = element.getAttribute("data-id");
                    if (id) {
                        if (openIds.includes(id)) {
                            element.show();
                        } else {
                            element.hide();
                        }
                    }
                });
            } else {
                detailsElements.forEach((element: any) => {
                    const id = element.getAttribute("data-id");
                    if (id === "get-started") {
                        element.show();
                    } else {
                        element.hide();
                    }
                });
            }
        } catch (error) {
            console.warn(`Could not restore sidebar state: ${error}`);
            detailsElements.forEach((element: any) => {
                const id = element.getAttribute("data-id");
                if (id === "get-started") {
                    element.show();
                } else {
                    element.hide();
                }
            });
        }

        setTimeout(() => {
            isInitializing = false;
        }, 100);
    });

    const summaryLinks = document.querySelectorAll(".mobile-sidebar .summary-link");

    summaryLinks.forEach((link) => {
        link.addEventListener("click", (event) => {
            event.stopPropagation();
        });

        link.addEventListener("keydown", (event) => {
            event.stopPropagation();
        });
    });
</script>

<style>
    .mobile-sidebar pc-details:not(:last-of-type) {
        margin-bottom: var(--pc-spacing-s);
    }

    .mobile-sidebar pc-details::part(summary) {
        font-weight: var(--pc-font-weight-bold);
    }

    .mobile-sidebar pc-details a[slot="summary"] {
        color: var(--pc-color-neutral-950);
        text-decoration: none;
    }

    .mobile-sidebar pc-details a[slot="summary"]:hover {
        color: var(--pc-color-primary-800);
    }

    .mobile-sidebar pc-details a[slot="summary"]:active {
        color: var(--pc-color-primary-700);
    }

    .mobile-sidebar pc-details ul {
        margin-left: var(--pc-spacing-xs);
        border-left: 1px solid var(--pc-color-neutral-200);
        list-style: none;
        padding-left: var(--pc-spacing-l);
    }

    .mobile-sidebar pc-details > ul {
        margin-top: -1rem;
    }

    .mobile-sidebar pc-details ul li {
        line-height: var(--pc-line-height-loose);
    }

    .mobile-sidebar pc-details ul li a {
        color: var(--pc-color-neutral-1000);
        text-decoration: none;
    }

    .mobile-sidebar pc-details ul li a:hover {
        text-decoration: 1px underline solid;
        text-underline-offset: 0.125rem;
    }

    .mobile-sidebar pc-details ul li a[aria-current="page"] {
        margin-left: -17px;
        padding-left: calc(var(--pc-spacing-l) - 1px);
        border-left: 3px solid var(--pc-color-primary-600);
        color: var(--pc-color-primary-600);
        font-weight: var(--pc-font-weight-semibold);
    }

    .mobile-sidebar pc-details .mobile-sidebar pc-details ul li ul {
        margin-top: var(--pc-spacing-s);
        margin-bottom: var(--pc-spacing-s);
    }

    @media screen and not (max-width: 1440px) {
        .mobile-sidebar {
            display: none;
        }
    }
</style>
