---
import {
    getLanguageFromURL,
    useTranslations,
    useTranslatedPath,
} from "../i18n/utilities.js";

import NavigationBar from "./NavigationBar.astro";
import Sidebar from "./Sidebar.astro";
import MobileSidebar from "./MobileSidebar.astro";

import ComponentInfo from "../components/ComponentInfo.astro";
import FallbackContentWarning from "../components/FallbackContentWarning.astro";
import Footer from "../components/Footer.astro";
import Search from "../components/Search.astro";
import TableOfContents from "../components/TableOfContents.astro";

import "placer-toolkit/dist/styles/placer.css";
import "placer-toolkit/dist/styles/themes/utility.css";
import "placer-toolkit/dist/styles/themes/serene.css";

import "../styles/main.css";
import "../styles/fonts.css";
import "../styles/anchor-headings.css";
import "../styles/utilities.css";

const language = getLanguageFromURL(Astro.url);
const translation = useTranslations(language);
const translatePath = useTranslatedPath(language);

const canonicalURL = new URL(Astro.url.pathname, Astro.site).href;

const enPathname = Astro.url.pathname.replace(/^\/de/, "");

const enURL = new URL(enPathname, Astro.site).href;
const deURL = new URL(`/de${enPathname}`, Astro.site).href;

const {
    title = "Untitled",
    description = `${translation("landingCTA.tagline.flexible")} ${translation("landingCTA.tagline.accessible")} ${translation("landingCTA.tagline.webComponents")}`,
    component = "",
    hero = false,
    pagefindIgnore = false,
    noSidebar = false,
    noBanner = false,
    showFooter = false,
    isFallback = false,
} = Astro.props;
---

<!doctype html>
<html
    lang={language}
    class:list={{ "pc-light": true, "no-sidebar": noSidebar, "hero": hero }}
    data-pagefind-ignore={pagefindIgnore ? "all" : undefined}
>
    <head>
        <meta charset="UTF-8" />
        <meta
            name="viewport"
            content="width=device-width, initial-scale=1.0, viewport-fit=cover, interactive-widget=resizes-visual"
        />
        <meta name="generator" content={Astro.generator} />
        <meta name="description" content={description} />
        <meta
            name="keywords"
            content="lit, placer, toolkit, litelement, components, placer-toolkit, web-components, custom-elements"
        />
        <meta name="author" content="Placer (maintainer: @randomguy-2650)" />
        <meta name="robots" content="index, follow" />
        <!-- Google Search Console verification -->
        <meta
            name="google-site-verification"
            content="FuYprzKlW9u11ARGzJPgLFZx6hUnTmCdYmqPkrOFq4E"
        />
        <meta property="og:type" content="website" />
        <meta property="og:title" content="Placer Toolkit" />
        <meta property="og:site_name" content="Placer Toolkit" />
        <meta
            property="og:url"
            content={new URL(Astro.url.pathname, Astro.site).href}
        />
        <meta
            property="og:description"
            content={`${translation("landingCTA.tagline.flexible")} ${translation("landingCTA.tagline.accessible")} ${translation("landingCTA.tagline.webComponents")}`}
        />
        <meta
            property="og:image"
            content={new URL("/images/og-image.png", Astro.site)}
        />
        <meta
            property="og:image:alt"
            content="A preview of Placer Toolkit components including terminal snippets, toggles and UI elements in a bentoâ€style grid."
        />
        <meta name="twitter:card" content="summary_large_image" />
        <meta name="twitter:title" content="Placer Toolkit" />
        <meta name="twitter:description" content={description} />
        <meta
            name="twitter:image"
            content={new URL("/images/og-image.png", Astro.site)}
        />
        <link rel="canonical" href={canonicalURL} />
        <link rel="alternate" hreflang="en" href={enURL} />
        <link rel="alternate" hreflang="de" href={deURL} />
        <link rel="preconnect" href="https://fonts.bunny.net" />
        <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
        <!-- Legacy fallback for search engine crawlers in search results -->
        <link
            rel="icon"
            type="image/x-icon"
            href="/brand/favicon.ico"
            sizes="any"
        />
        <link rel="icon" type="image/svg+xml" href="/brand/favicon.svg" />
        <!-- Placer Toolkit -->
        <script>
            // Weâ€™re using the CDN builds here as the Placer Toolkit translations donâ€™t work for some reason.
            import "placer-toolkit/cdn/placer.js";
            import "placer-toolkit/cdn/translations/de.js";
        </script>
        <script is:inline>
            (() => {
                const prefersDark = window.matchMedia(
                    "(prefers-color-scheme: dark)",
                ).matches;
                const theme = prefersDark ? "pc-dark" : "pc-light";

                document.documentElement.classList.add(theme);
                document.documentElement.classList.remove(
                    theme === "pc-dark" ? "pc-light" : "pc-dark",
                );
            })();
        </script>
        <!-- Cabin Analytics -->
        <script src="https://scripts.withcabin.com/hello.js" async is:inline
        ></script>
        <title>{hero ? title : `${title} | Placer Toolkit`}</title>
    </head>
    <body>
        <div class="layout-container">
            <pc-button
                href="#main-content"
                appearance="neutral"
                variant="filled outlined"
                class="skip-to-main-content pc-visually-hidden"
            >
                {translation("button.skipToMainContent")}
            </pc-button>

            <NavigationBar noSidebar={noSidebar} />

            <MobileSidebar />

            {!noSidebar ? <Sidebar /> : undefined}

            <Search />

            <noscript>
                {translation("js.noscript")}
            </noscript>

            <main
                lang={isFallback ? "en" : undefined}
                dir={isFallback ? "ltr" : undefined}
                class:list={[{ hero: hero }]}
                id="main-content"
                tabindex="-1"
            >
                {
                    !hero ? (
                        <div class="content-layout">
                            <article data-pagefind-body>
                                <pc-button
                                    href="#table-of-contents"
                                    appearance="neutral"
                                    variant="filled outlined"
                                    size="small"
                                    class="skip-to-toc pc-desktop-only pc-visually-hidden"
                                    data-pagefind-ignore
                                >
                                    {translation(
                                        "button.skipToTableOfContents",
                                    )}
                                </pc-button>

                                <pc-details
                                    class="toc-mobile"
                                    summary={translation("ui.toc.onThisPage")}
                                    data-pagefind-ignore="all"
                                >
                                    <ul
                                        class="toc-ul"
                                        data-overview={translation(
                                            "ui.toc.overview",
                                        )}
                                    />
                                </pc-details>

                                <header id="_top">
                                    <h1>{title}</h1>

                                    {component ? (
                                        <ComponentInfo
                                            componentName={component}
                                        />
                                    ) : (
                                        ""
                                    )}

                                    <FallbackContentWarning
                                        isFallback={isFallback}
                                    />
                                </header>

                                <slot />
                            </article>

                            <TableOfContents />
                        </div>
                    ) : (
                        <>
                            {!noBanner && (
                                <pc-callout
                                    class="hero-callout"
                                    appearance="primary"
                                    size="small"
                                    data-pagefind-ignore="all"
                                >
                                    <span
                                        slot="icon"
                                        style="user-select: none; -webkit-user-select: none"
                                        aria-hidden="true"
                                    >
                                        ðŸš€
                                    </span>
                                    <div class="pc-split">
                                        <b style="flex: 1">
                                            {translation(
                                                "getStartedBanner.readyToStart",
                                            )}
                                        </b>
                                        <pc-button
                                            appearance="primary"
                                            size="small"
                                            href={translatePath(
                                                "/docs/get-started/installation",
                                            )}
                                        >
                                            {translation("button.getStarted")}
                                            <pc-icon
                                                class="arrow-right-move"
                                                library="default"
                                                icon-style="solid"
                                                name="chevron-right"
                                                slot="suffix"
                                            />
                                        </pc-button>
                                    </div>
                                </pc-callout>
                            )}

                            <slot />
                        </>
                    )
                }
            </main>

            {showFooter ? <Footer /> : undefined}
        </div>

        <pc-dialog
            label={translation("nav.content.legal.contact")}
            id="contact-info"
        >
            <p>
                {translation("contact.paragraph.1")}
            </p>

            <p set:html={translation("contact.paragraph.2")} />

            <p>{translation("contact.paragraph.3")}</p>

            <pc-button
                appearance="primary"
                variant="plain"
                slot="footer"
                data-dialog="close"
            >
                <pc-icon
                    library="default"
                    icon-style="solid"
                    name="phone"
                    slot="prefix"></pc-icon>

                {translation("button.gotIt")}
            </pc-button>
        </pc-dialog>

        <pc-dialog id="v0-site-warning">
            <span slot="label">
                <pc-icon
                    library="default"
                    icon-style="solid"
                    name="triangle-exclamation"
                    style="margin-inline-end: var(--pc-spacing-xs); translate: 0 0.25rem; color: var(--pc-color-warning-on-quiet)"
                ></pc-icon>
                {translation("dangerousLands.label")}
            </span>

            <p set:html={translation("dangerousLands.paragraph.1")} />

            <p>
                {translation("dangerousLands.paragraph.2")}
            </p>

            <pc-button
                href="https://v0-placer-toolkit.vercel.app"
                appearance="danger"
                variant="plain"
                slot="footer"
            >
                <pc-icon
                    library="default"
                    icon-style="solid"
                    name="fire"
                    slot="prefix"></pc-icon>
                {translation("button.yikes")}
            </pc-button>
            <!-- Appearances in buttons are purely visual, no accessibility affected! -->
            <pc-button
                appearance="warning"
                variant="plain"
                slot="footer"
                data-dialog="close"
            >
                <pc-icon
                    library="default"
                    icon-style="solid"
                    name="star"
                    slot="prefix"></pc-icon>
                {translation("button.powerUp")}
            </pc-button>
        </pc-dialog>

        <script>
            // Mobile sidebar
            const mobileSidebar = document.querySelector(
                ".mobile-sidebar",
            ) as HTMLDialogElement;
            const sidebarToggle = document.querySelector(".sidebar-toggle");

            sidebarToggle?.addEventListener(
                "click",
                () => (mobileSidebar.open = true),
            );
        </script>
    </body>
</html>
