---
import {
    getLanguageFromURL,
    useTranslations,
} from "../i18n/utilities.js";

import CodeBlock from "./CodeBlock.astro";

const language = getLanguageFromURL(Astro.url);
const translation = useTranslations(language);

const bootstrapCode = `<!-- Bootstrap -->
<div class="bg-light min-vh-100">
    <nav
        class="navbar bg-white border-bottom px-3 d-flex justify-content-between align-items-center"
    >
        <div>
            <img
                src="https://placer-toolkit.vercel.app/brand/logo.svg"
                width="36"
                height="36"
                alt="${translation("codeComparison.logo")}"
            />
        </div>

        <div class="dropdown">
            <button
                class="btn btn-sm btn-link text-decoration-none dropdown-toggle rounded-pill d-flex align-items-center gap-2 border"
                type="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
            >
                ${translation("codeComparison.signIn")}
            </button>

            <ul class="dropdown-menu dropdown-menu-end shadow-sm">
                <li>
                    <a
                        class="dropdown-item d-flex align-items-center gap-2"
                        href="#"
                    >
                        <i class="bi bi-person-plus"></i>
                        ${translation("codeComparison.dropdown.addUser")}
                    </a>
                </li>
                <li>
                    <a
                        class="dropdown-item d-flex align-items-center gap-2"
                        href="#"
                    >
                        <i class="bi bi-trash"></i>
                        ${translation("codeComparison.dropdown.deleteAccount")}
                    </a>
                </li>
            </ul>
        </div>

        <div>
            <button
                class="btn btn-sm btn-outline-danger rounded-pill"
                aria-label="${translation("codeComparison.report")}"
            >
                <i class="bi bi-flag-fill"></i>
            </button>
        </div>
    </nav>

    <main
        class="container-fluid d-flex justify-content-center align-items-center p-4"
    >
        <div class="card border-0 shadow-sm p-4 w-100">
            <h1 class="h3 text-center mb-4">${translation("codeComparison.signIn")}</h1>

            <form>
                <div class="mb-3">
                    <label class="form-label small fw-medium">${translation("codeComparison.email")}</label>

                    <div class="input-group">
                        <span
                            class="input-group-text bg-transparent border-end-0"
                        >
                            <i class="bi bi-envelope-fill"></i>
                        </span>

                        <input
                            type="email"
                            class="form-control border-start-0"
                            placeholder="${translation("codeComparison.email.example")}"
                        />
                    </div>
                </div>

                <div class="mb-4">
                    <label class="form-label small fw-medium">${translation("codeComparison.password")}</label>

                    <div class="input-group">
                        <span
                            class="input-group-text bg-transparent border-end-0"
                        >
                            <i class="bi bi-key-fill"></i>
                        </span>

                        <input
                            type="password"
                            class="form-control border-start-0"
                        />
                    </div>
                    <div class="mt-2 text-end">
                        <a class="small text-decoration-none" href="#">
                            ${translation("codeComparison.password.forgot")}
                        </a>
                    </div>
                </div>

                <div class="d-grid">
                    <button
                        type="submit"
                        class="btn btn-primary d-flex align-items-center justify-content-center gap-2"
                    >
                        <i class="bi bi-box-arrow-in-right"></i>
                        ${translation("codeComparison.signIn")}
                    </button>
                </div>
            </form>
        </div>
    </main>
</div>

<style>
    .navbar {
        block-size: 3.5rem;
    }

    .navbar div:first-child img {
        translate: 0 0.125rem;
    }

    main .card {
        max-inline-style: 30rem;
        border-radius: 1.5rem;
    }
</style>`;

const placerToolkitCode = `<!-- Placer Toolkit -->
<nav class="navigation-bar pc-split">
    <div>
        <img
            src="https://placer-toolkit.vercel.app/brand/logo.svg"
            width="36"
            height="36"
            alt="${translation("codeComparison.logo")}"
        />
    </div>
    <div>
        <pc-dropdown size="small">
            <pc-button
                class="sign-in-dropdown"
                size="small"
                variant="plain"
                slot="trigger"
                pill
            >
                ${translation("codeComparison.signIn")}

                <pc-icon
                    library="default"
                    icon-style="solid"
                    name="chevron-down"
                    slot="suffix"
                ></pc-icon>
            </pc-button>

            <pc-dropdown-item>
                <pc-icon
                    library="default"
                    icon-style="solid"
                    name="user-plus"
                    slot="icon"
                ></pc-icon>
                ${translation("codeComparison.dropdown.addUser")}
            </pc-dropdown-item>
            <pc-dropdown-item appearance="danger">
                <pc-icon
                    library="default"
                    icon-style="solid"
                    name="trash"
                    slot="icon"
                ></pc-icon>
                ${translation("codeComparison.dropdown.deleteAccount")}
            </pc-dropdown-item>
        </pc-dropdown>
    </div>
    <div>
        <pc-button size="small" appearance="danger" variant="plain" pill>
            <pc-icon
                library="default"
                icon-style="solid"
                name="flag"
                label="${translation("codeComparison.report")}"
            ></pc-icon>
        </pc-button>
    </div>
</nav>

<main class="main-content">
    <form class="pc-stack">
        <h1>${translation("codeComparison.signIn")}</h1>

        <pc-input label="${translation("codeComparison.email")}" type="email" placeholder="${translation("codeComparison.email.example")}">
            <pc-icon
                library="default"
                icon-style="solid"
                name="envelope"
                slot="prefix"
            ></pc-icon>
        </pc-input>

        <pc-input label="${translation("codeComparison.password")}" type="password" password-toggle>
            <pc-icon
                library="default"
                icon-style="solid"
                name="key"
                slot="prefix"
            ></pc-icon>

            <a href="#" slot="hint">${translation("codeComparison.password.forgot")}</a>
        </pc-input>

        <pc-button appearance="primary">
            <pc-icon
                library="default"
                icon-style="solid"
                name="arrow-right-to-bracket"
                slot="prefix"
            ></pc-icon>
            ${translation("codeComparison.signIn")}
        </pc-button>
    </form>
</main>

<style>
    .navigation-bar {
        display: flex;
        align-items: center;
        padding-inline: var(--pc-spacing-m);
        block-size: 3.5rem;
        background-color: var(--pc-color-surface-raised);
        border-block-end: var(--pc-border-width-s) var(--pc-border-style)
            var(--pc-color-surface-border);
    }

    .navigation-bar div:first-child img {
        translate: 0 0.125rem;
    }

    .main-content {
        inline-size: 100%;
        background-color: var(--pc-color-surface-default);
    }

    .main-content form {
        padding: var(--pc-spacing-l);
        max-inline-size: 95%;
        inline-size: 30rem;
        background-color: var(--pc-color-surface-raised);
        border-radius: var(--pc-border-radius-xl);
        box-shadow: var(--pc-shadow-m);
    }

    .main-content form h1 {
        font-size: var(--pc-font-size-xl);
        text-align: center;
    }
</style>`;

const previewHTML = placerToolkitCode.replace(
    /<style>([\s\S]*?)<\/style>/,
    (match, css) => `<style>${css.replace(/\.(?=[a-zA-Z])/g, ".preview .")}</style>`
);
---

<div class="code-comparison">
    <pc-comparer>
        <div slot="before">
            <CodeBlock language="html" showLineNumbers>
                {bootstrapCode}
            </CodeBlock>
        </div>
        <div slot="after">
            <CodeBlock language="html" showLineNumbers>
                {placerToolkitCode}
            </CodeBlock>
        </div>
    </pc-comparer>

    <div class="preview" set:html={previewHTML}></div>
</div>

<style>
    .code-comparison {
        display: flex;
        align-items: stretch;
        justify-content: center;
        gap: var(--pc-spacing-xl);
        margin-block-end: var(--pc-spacing-xxl);
    }

    pc-comparer {
        --divider-width: 0.0625rem;

        border-radius: var(--pc-border-radius-xl);
        overflow: hidden;
    }

    pc-comparer [slot~="before"],
    pc-comparer [slot~="after"] {
        block-size: calc(28rem * var(--pc-spacing-scale));
        overflow: hidden;
    }

    pc-comparer::part(before),
    pc-comparer::part(after) {
        pointer-events: auto;
    }

    pc-comparer::part(divider),
    pc-comparer::part(handle) {
        background-color: var(--pc-color-surface-border);
        translate: unset;
    }

    pc-comparer :global(.code-block-container) {
        display: flex;
        flex-direction: column;
        block-size: 100%;
    }

    pc-comparer :global(.code-block) {
        border-radius: var(--pc-border-radius-xl);
        overflow: hidden;
    }

    pc-comparer :global(.code-block pre) {
        overflow: auto;
        block-size: 100%;
    }

    pc-comparer :global(.code-block pre:focus-visible) {
        outline: var(--pc-focus-ring);
        outline-offset: var(--pc-focus-ring-offset);
    }

    pc-comparer :global(pc-copy-button) {
        display: none;
    }

    .preview {
        min-inline-size: 35%;
        block-size: calc(28rem * var(--pc-spacing-scale));
        border: var(--pc-border-width-s) var(--pc-border-style)
            var(--pc-color-surface-border);
        border-radius: var(--pc-border-radius-xl);
        overflow: hidden;
    }

    @media screen and (max-width: 992px) {
        .code-comparison {
            flex-direction: column-reverse;
        }

        .preview {
            min-inline-size: unset;
            min-block-size: 35%;
        }
    }
</style>
