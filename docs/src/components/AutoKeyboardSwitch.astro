---
const { keyName } = Astro.props;

// fallback for unknown keys
const fallbackDisplayKey = keyName
    ? keyName.charAt(0).toUpperCase() + keyName.slice(1)
    : "";
---

<kbd
    class="keyboard-key"
    data-key={keyName?.toLowerCase() || ""}
    aria-label={fallbackDisplayKey}>{fallbackDisplayKey}</kbd
>

<script>
    (() => {
        const keys = document.querySelectorAll<HTMLElement>(".keyboard-key");

        const isAppleDevice =
            // @ts-expect-error — TypeScript does not recognise navigator.userAgentData yet
            navigator.userAgentData?.platform?.toLowerCase().includes("mac") ||
            /mac|iphone|ipad|ipod/i.test(navigator.platform);

        const keyMap: Record<
            string,
            { mac: string; macLabel: string; win: string; winLabel: string }
        > = {
            meta: {
                mac: "⌘",
                macLabel: "Command",
                win: "Windows",
                winLabel: "Windows",
            },
            command: {
                mac: "⌘",
                macLabel: "Command",
                win: "Ctrl",
                winLabel: "Control",
            },
            ctrl: {
                mac: "⌃",
                macLabel: "Control",
                win: "Ctrl",
                winLabel: "Control",
            },
            shift: {
                mac: "⇧",
                macLabel: "Shift",
                win: "Shift",
                winLabel: "Shift",
            },
            alt: { mac: "⌥", macLabel: "Option", win: "Alt", winLabel: "Alt" },
            altgr: {
                mac: "⌥",
                macLabel: "Option",
                win: "AltGr",
                winLabel: "AltGr",
            },
            enter: {
                mac: "Return",
                macLabel: "Return",
                win: "Enter",
                winLabel: "Enter",
            },
            delete: {
                mac: "⌦",
                macLabel: "Delete",
                win: "Del",
                winLabel: "Delete",
            },
            tab: { mac: "⇥", macLabel: "Tab", win: "Tab", winLabel: "Tab" },
        };

        keys.forEach((key) => {
            const keyType = key.dataset.key;

            if (!keyType) {
                return;
            }

            const keyInfo = keyMap[keyType];

            if (keyInfo) {
                key.textContent = isAppleDevice ? keyInfo.mac : keyInfo.win;
                key.setAttribute(
                    "aria-label",
                    isAppleDevice ? keyInfo.macLabel : keyInfo.winLabel,
                );
            } else {
                const display =
                    keyType.charAt(0).toUpperCase() + keyType.slice(1);

                key.textContent = display;
                key.setAttribute("aria-label", display);
            }
        });
    })();
</script>
