---
import { Image } from "astro:assets";
import {
    getLanguageFromURL,
    useTranslations,
    useTranslatedPath,
} from "../i18n/utilities.js";

import CodeBlock from "./CodeBlock.astro";

import placerToolkitLogo from "../assets/logo.svg";
import placerToolkitLightLogo from "../assets/logo-wordmark-light.svg";
import placerToolkitDarkLogo from "../assets/logo-wordmark-dark.svg";

const language = getLanguageFromURL(Astro.url);
const translation = useTranslations(language);
const translatePath = useTranslatedPath(language);
---

<div class="landing-cta">
    <div class="content">
        <div>
            <pc-callout
                class="hero-callout pc-cloak"
                appearance="primary"
                size="small"
                data-pagefind-ignore="all"
            >
                <span
                    slot="icon"
                    style="user-select: none; -webkit-user-select: none"
                    aria-hidden="true"
                >
                    ðŸš€
                </span>
                <div class="pc-split">
                    <b style="flex: 1">
                        {translation("getStartedBanner.readyToStart")}
                    </b>
                    <pc-button
                        appearance="primary"
                        size="small"
                        href={translatePath("/docs/get-started/installation")}
                    >
                        {translation("button.getStarted")}

                        <pc-icon
                            class="arrow-right-move"
                            library="default"
                            icon-style="solid"
                            name="chevron-right"
                            slot="suffix"></pc-icon>
                    </pc-button>
                </div>
            </pc-callout>

            <div
                class="splash-logo theme-dependent-content-switcher"
                role="heading"
                aria-level="1"
            >
                <Image
                    class="light-content"
                    src={placerToolkitLightLogo}
                    width="300"
                    height="58.25"
                    loading="eager"
                    alt=""
                />
                <Image
                    class="dark-content"
                    src={placerToolkitDarkLogo}
                    width="300"
                    height="58.25"
                    loading="eager"
                    alt=""
                />
                <span class="pc-visually-hidden">Placer Toolkit</span>
            </div>

            <h1
                class="headline"
                set:html={translation("landingCTA.marketingLine")}
            />

            <h2 class="tagline">
                <span>{translation("landingCTA.tagline.flexible")}</span>
                <span>{translation("landingCTA.tagline.accessible")}</span>
                <span style="white-space: nowrap">
                    {translation("landingCTA.tagline.webComponents")}
                </span>
            </h2>
        </div>
        <div>
            <div class="splash-buttons">
                <pc-tab-group class="pc-cloak">
                    <pc-tab slot="navigation" panel="npm">npm</pc-tab>
                    <pc-tab slot="navigation" panel="yarn">Yarn</pc-tab>
                    <pc-tab slot="navigation" panel="pnpm">pnpm</pc-tab>
                    <pc-tab slot="navigation" panel="bun">Bun</pc-tab>

                    <pc-tab-panel name="npm">
                        <CodeBlock language="bash">
                            {`$ npm install placer-toolkit`}
                        </CodeBlock>
                    </pc-tab-panel>
                    <pc-tab-panel name="yarn">
                        <CodeBlock language="bash">
                            {`$ yarn add placer-toolkit`}
                        </CodeBlock>
                    </pc-tab-panel>
                    <pc-tab-panel name="pnpm">
                        <CodeBlock language="bash">
                            {`$ pnpm add placer-toolkit`}
                        </CodeBlock>
                    </pc-tab-panel>
                    <pc-tab-panel name="bun">
                        <CodeBlock language="bash">
                            {`$ bun add placer-toolkit`}
                        </CodeBlock>
                    </pc-tab-panel>
                </pc-tab-group>
                <div class="pc-flank:end pc-gap-s">
                    <pc-button
                        appearance="primary"
                        variant="filled outlined"
                        href={translatePath("/docs/get-started/installation")}
                    >
                        {translation("button.getStarted")}
                    </pc-button>
                    <pc-button
                        appearance="neutral"
                        variant="filled outlined"
                        href="https://github.com/placer-toolkit/placer-toolkit"
                        rel="noreferrer noopener"
                        target="_blank"
                    >
                        <pc-icon
                            class="icon-expand"
                            library="default"
                            icon-style="brands"
                            name="github"
                            label="GitHub"></pc-icon>
                    </pc-button>
                </div>
            </div>
        </div>
    </div>
    <div class="animation" aria-hidden="true">
        <div class="box">
            <Image
                src={placerToolkitLogo}
                width="56"
                height="56"
                loading="eager"
                alt=""
            />
        </div>
        <div class="avatars">
            <pc-avatar style="--size: 4rem; --index: 1">
                <pc-icon
                    library="default"
                    icon-style="solid"
                    name="puzzle-piece"
                    slot="icon"></pc-icon>
            </pc-avatar>
            <pc-avatar style="--size: 4rem; --index: 2">
                <pc-icon
                    library="default"
                    icon-style="solid"
                    name="universal-access"
                    slot="icon"></pc-icon>
            </pc-avatar>
            <pc-avatar style="--size: 4rem; --index: 3">
                <pc-icon
                    library="default"
                    icon-style="solid"
                    name="shield-halved"
                    slot="icon"></pc-icon>
            </pc-avatar>
            <pc-avatar style="--size: 4rem; --index: 4">
                <pc-icon
                    library="default"
                    icon-style="solid"
                    name="paintbrush"
                    slot="icon"></pc-icon>
            </pc-avatar>
            <pc-avatar style="--size: 4rem; --index: 5">
                <pc-icon
                    library="default"
                    icon-style="solid"
                    name="globe"
                    slot="icon"></pc-icon>
            </pc-avatar>
            <pc-avatar style="--size: 4rem; --index: 6">
                <pc-icon
                    library="default"
                    icon-style="solid"
                    name="feather"
                    slot="icon"></pc-icon>
            </pc-avatar>
        </div>
    </div>

    <pc-button
        class="pause-button"
        appearance="primary"
        variant="filled"
        pill
        aria-hidden="true"
    >
        <pc-icon
            library="default"
            icon-style="solid"
            name="pause"
            label="Pause animation"></pc-icon>
    </pc-button>
</div>

<script>
    import type { PcButton } from "placer-toolkit/dist/components/button/button.js";

    const animation = document.querySelector<HTMLDivElement>(
        ".landing-cta > .animation",
    );
    const centerPiece = animation?.querySelector<HTMLDivElement>(".box");
    const pauseButton = document.querySelector<PcButton>(
        ".landing-cta .pause-button",
    );

    if (pauseButton && animation) {
        pauseButton.addEventListener("click", () => {
            const avatars =
                animation.querySelectorAll<HTMLDivElement>("pc-avatar");

            const currentState =
                avatars[0]?.style.animationPlayState ||
                getComputedStyle(avatars[0]).animationPlayState;
            const isPaused = currentState === "paused";
            const newState = isPaused ? "running" : "paused";

            avatars.forEach((avatar) => {
                avatar.style.animationPlayState = newState;
            });

            if (centerPiece) {
                centerPiece.style.animationPlayState = newState;
            }

            const icon = pauseButton.querySelector("pc-icon");

            if (icon) {
                icon.setAttribute("name", isPaused ? "pause" : "play");
                icon.setAttribute(
                    "label",
                    isPaused ? "Pause animation" : "Play animation",
                );
            }
        });
    }
</script>

<style>
    :global(#main-content) {
        padding-block-start: 0;
    }

    .landing-cta {
        display: flex;
        position: relative;
        align-items: flex-start;
        justify-content: center;
        margin-inline: calc(-1 * var(--pc-spacing-xxxxl));
        margin-block-end: var(--pc-spacing-xxxl);
        inline-size: calc(100% + (var(--pc-spacing-xxxxl) * 2));
        border-block-end: var(--pc-border-width-s) var(--pc-border-style)
            var(--pc-color-surface-border);
    }

    .landing-cta > .content {
        display: flex;
        position: relative;
        align-items: flex-start;
        justify-content: space-evenly;
        flex-direction: column;
        padding-inline: var(--pc-spacing-xxxxl);
        inline-size: 100%;
        block-size: 100%;
        border-inline-end: var(--pc-border-width-s) var(--pc-border-style)
            var(--pc-color-surface-border);
    }

    .landing-cta > .content > div {
        display: flex;
        align-items: flex-start;
        flex-direction: column;
        gap: var(--pc-spacing-xxl);
        inline-size: auto;
    }

    .landing-cta > .content .splash-logo svg {
        inline-size: 100%;
        margin-block-end: -0.5625rem;
    }

    .landing-cta > .content .headline {
        margin: 0;
        line-height: 1.2;
        text-align: start;
        letter-spacing: -0.03125em;
    }

    .landing-cta > .content .tagline {
        margin-block-end: -0.5625rem;
        color: var(--pc-color-text-quiet);
        font-weight: var(--pc-font-weight-bold);
        font-size: var(--pc-font-size-l);
        text-align: start;
    }

    .landing-cta > .content .splash-buttons {
        display: flex;
        flex-direction: column;
        gap: var(--pc-spacing-s);
        inline-size: 20vmax;
        max-inline-size: 90dvw;
    }

    .landing-cta > .content .splash-buttons pc-tab-panel {
        padding-block-end: 0;
    }

    .landing-cta > .content .splash-buttons :global(.code-block-container) {
        margin-block-end: 0;
    }

    .landing-cta
        > .content
        .splash-buttons
        :global(.code-block-container .shiki) {
        padding: var(--pc-spacing-m) !important;
    }

    .landing-cta
        > .content
        .splash-buttons
        :global(.code-block-container pc-copy-button) {
        inset-block-start: calc(var(--pc-spacing-s) - 0.0625em);
        inset-inline-end: calc(var(--pc-spacing-s) - 0.0625em);
    }

    .landing-cta > .content .splash-buttons pc-button::part(base) {
        border-radius: var(--pc-border-radius-l);
        transition:
            all var(--pc-transition-fast) ease-in-out,
            translate var(--pc-transition-medium) cubic-bezier(0.4, 0, 0.2, 1),
            border-radius var(--pc-transition-medium)
                cubic-bezier(0.68, 0, 0.32, 1.6);
    }

    @media (hover: hover) {
        .landing-cta
            > .content
            .splash-buttons
            pc-button::part(base):hover:not(:active) {
            translate: 0 -0.25rem;
            transition:
                all var(--pc-transition-fast) ease-in-out,
                translate var(--pc-transition-medium)
                    cubic-bezier(0.18, 0.89, 0.32, 1.28),
                border-radius var(--pc-transition-medium)
                    cubic-bezier(0.68, 0, 0.32, 1.6);
        }

        .landing-cta
            > .content
            .splash-buttons
            pc-button::part(base):hover:active {
            translate: 0 -0.25rem;
            transition:
                all var(--pc-transition-fast) ease-in-out,
                translate var(--pc-transition-medium)
                    cubic-bezier(0.18, 0.89, 0.32, 1.28),
                border-radius var(--pc-transition-slow)
                    cubic-bezier(0.34, 2, 0.64, 1);
        }
    }

    .landing-cta > .content .splash-buttons pc-button::part(base):active {
        border-radius: var(--pc-border-radius-s);
        transition:
            all var(--pc-transition-fast) ease-in-out,
            border-radius var(--pc-transition-slow)
                cubic-bezier(0.34, 2, 0.64, 1);
    }

    .landing-cta > .animation {
        position: relative;
        inline-size: 600px;
        block-size: 600px;
    }

    .landing-cta > .animation .box {
        position: absolute;
        inset-block-start: 50%;
        inset-inline-start: 50%;
        padding: var(--pc-spacing-l);
        inline-size: 5.625rem;
        block-size: 5.625rem;
        aspect-ratio: 1 / 1;
        background-color: color-mix(
            in oklab,
            var(--pc-color-surface-raised),
            transparent 40%
        );
        border: var(--pc-border-width-s) var(--pc-border-style)
            color-mix(in oklab, var(--pc-color-surface-border), transparent 40%);
        backdrop-filter: blur(8px);
        -webkit-backdrop-filter: blur(8px);
        border-radius: var(--pc-border-radius-xl);
        translate: -50% -50%;
        animation: core-pulse 7s ease-in-out infinite;
        box-shadow: var(--pc-shadow-l);
        z-index: 1;
    }

    .landing-cta > .animation .box::before {
        content: "";
        position: absolute;
        inset: -50px;
        background: radial-gradient(
            circle,
            color-mix(
                    in oklab,
                    var(--pc-color-primary-fill-normal),
                    transparent 95%
                )
                0%,
            transparent 70%
        );
        z-index: -1;
        filter: blur(20px);
        pointer-events: none;
    }

    .landing-cta > .animation .avatars {
        --circle-radius: 200px;
        display: flex;
        position: relative;
        align-items: center;
        justify-content: center;
        inline-size: 600px;
        block-size: 600px;
        z-index: 0;
    }

    .landing-cta > .animation .avatars pc-avatar {
        position: absolute;
        opacity: 0;
        will-change: transform, filter;
        animation: tile-lifecycle 7s cubic-bezier(0.34, 1.56, 0.64, 1) infinite;
        animation-delay: calc(var(--index) * 0.1s);
    }

    .landing-cta > .animation .avatars pc-avatar:nth-child(1) {
        --angle: 270deg;
    }

    .landing-cta > .animation .avatars pc-avatar:nth-child(2) {
        --angle: 330deg;
    }

    .landing-cta > .animation .avatars pc-avatar:nth-child(3) {
        --angle: 30deg;
    }

    .landing-cta > .animation .avatars pc-avatar:nth-child(4) {
        --angle: 90deg;
    }

    .landing-cta > .animation .avatars pc-avatar:nth-child(5) {
        --angle: 150deg;
    }

    .landing-cta > .animation .avatars pc-avatar:nth-child(6) {
        --angle: 210deg;
    }

    .landing-cta
        > .animation
        .avatars
        pc-avatar:has(> pc-icon[name="puzzle-piece"])::part(base) {
        background-color: var(--pc-color-green-50);
        color: var(--pc-color-green-90);
    }

    .landing-cta
        > .animation
        .avatars
        pc-avatar:has(> pc-icon[name="universal-access"])::part(base) {
        background-color: var(--pc-color-blue-50);
        color: var(--pc-color-blue-90);
    }

    .landing-cta
        > .animation
        .avatars
        pc-avatar:has(> pc-icon[name="shield-halved"])::part(base) {
        background-color: var(--pc-color-purple-50);
        color: var(--pc-color-purple-90);
    }

    .landing-cta
        > .animation
        .avatars
        pc-avatar:has(> pc-icon[name="paintbrush"])::part(base) {
        background-color: var(--pc-color-pink-50);
        color: var(--pc-color-pink-90);
    }

    .landing-cta
        > .animation
        .avatars
        pc-avatar:has(> pc-icon[name="globe"])::part(base) {
        background-color: var(--pc-color-indigo-50);
        color: var(--pc-color-indigo-90);
    }

    .landing-cta
        > .animation
        .avatars
        pc-avatar:has(> pc-icon[name="feather"])::part(base) {
        background-color: var(--pc-color-cyan-50);
        color: var(--pc-color-cyan-90);
    }

    .landing-cta > .pause-button {
        position: absolute;
        inset-block-end: var(--pc-spacing-l);
        inset-inline-end: var(--pc-spacing-l);
    }

    @keyframes tile-lifecycle {
        0% {
            opacity: 0;
            transform: rotate(var(--angle)) translate(0)
                rotate(calc(-1 * var(--angle))) scale(0);
            filter: blur(10px);
        }

        8% {
            filter: blur(0);
            opacity: 1;
        }

        15% {
            scale: 1.1;
        }

        25%,
        80% {
            opacity: 1;
            transform: rotate(var(--angle)) translate(var(--circle-radius))
                rotate(calc(-1 * var(--angle))) scale(1);
            filter: blur(0);
        }

        81% {
            filter: blur(5px);
            transform: rotate(var(--angle))
                translate(calc(var(--circle-radius) * 1.05))
                rotate(calc(-1 * var(--angle))) scale(1.05);
            opacity: 1;
        }

        94% {
            opacity: 0;
            transform: rotate(var(--angle)) translate(0)
                rotate(calc(-1 * var(--angle))) scale(0);
        }
    }

    @keyframes core-pulse {
        0%,
        100% {
            box-shadow: var(--pc-shadow-offset-x-m) var(--pc-shadow-offset-y-m)
                var(--pc-shadow-blur-l)
                color-mix(
                    in oklab,
                    var(--pc-color-primary-border-loud),
                    transparent 90%
                );
            border-color: color-mix(
                in oklab,
                var(--pc-color-primary-border-loud),
                transparent 90%
            );
        }

        50% {
            box-shadow: var(--pc-shadow-offset-x-l) var(--pc-shadow-offset-y-l)
                var(--pc-shadow-blur-l)
                color-mix(
                    in oklab,
                    var(--pc-color-primary-border-loud),
                    transparent 70%
                );
            border-color: color-mix(
                in oklab,
                var(--pc-color-primary-border-loud),
                transparent 60%
            );
        }
    }

    @media (prefers-reduced-motion: reduce) {
        .landing-cta > .animation .avatars pc-avatar,
        .landing-cta > .animation .box {
            opacity: 1;
            transform: rotate(var(--angle)) translate(var(--circle-radius))
                rotate(calc(-1 * var(--angle))) scale(1);
            animation: none !important;
        }

        .landing-cta > .animation .box {
            box-shadow: var(--pc-shadow-offset-x-m) var(--pc-shadow-offset-y-m)
                var(--pc-shadow-blur-l)
                color-mix(
                    in oklab,
                    var(--pc-color-primary-border-loud),
                    transparent 90%
                );
            border-color: color-mix(
                in oklab,
                var(--pc-color-primary-border-loud),
                transparent 90%
            );
        }
    }

    @media screen and (max-width: 1200px) {
        .landing-cta {
            align-items: center;
            flex-direction: column;
        }

        .landing-cta > .content {
            align-items: center;
            gap: var(--pc-spacing-l);
            padding-block-start: var(--pc-spacing-xxxl);
            border-inline-end: none;
        }

        .landing-cta > .content > div {
            align-items: center;
        }

        .landing-cta > .content .headline,
        .landing-cta > .content .tagline {
            text-align: center;
        }

        .landing-cta > .content .splash-buttons {
            inline-size: 30vmax;
        }
    }

    @media screen and (max-width: 768px) {
        .landing-cta > .content .splash-buttons {
            inline-size: 40vmax;
        }
    }

    @media screen and (max-width: 500px) {
        .landing-cta > .animation .avatars {
            --circle-radius: 150px;
        }
    }

    @media screen and (max-width: 400px) {
        .landing-cta > .content .splash-buttons {
            inline-size: 100%;
        }

        .landing-cta > .animation .avatars {
            --circle-radius: 125px;
        }
    }
</style>
